# ç³»ç»Ÿå»ºæ¨¡æŠ¥å‘Š

## å‰ç«¯

1. **å¼•è¨€**
    * æœ¬æ–‡æ¡£æ—¨åœ¨ä½¿ç”¨UMLç­‰å»ºæ¨¡æ–¹æ³•æè¿°**Timer**å‰ç«¯ç³»ç»Ÿçš„ç»“æ„ã€è¡Œä¸ºå’Œäº¤äº’ã€‚
    * æ¶µç›–æ‰€æœ‰å‰ç«¯ç”¨æˆ·ç•Œé¢ã€ç”¨æˆ·äº¤äº’é€»è¾‘ã€çŠ¶æ€ç®¡ç†ã€APIè°ƒç”¨é€»è¾‘ã€‚**ä¸æ¶µç›–**åç«¯å†…éƒ¨é€»è¾‘ã€‚
    * ä½¿ç”¨`draw.io`ç»˜åˆ¶ã€‚
2. **ç”¨ä¾‹å›¾**
    * ![ç”¨ä¾‹å›¾](photos/frontends/ç”¨ä¾‹å›¾.png)
3. **ç±»å›¾**
    * ![ç±»å›¾](photos/frontends/ç±»å›¾.png)
4. **åºåˆ—å›¾**
    * ç™»å½•æµç¨‹å›¾ï¼š
    * ![ç™»å½•æµç¨‹å›¾](photos/frontends/ç™»å½•æµç¨‹å›¾.png)
    * ä¿®æ”¹æ—¥ç¨‹æµç¨‹å›¾ï¼š
    * ![ä¿®æ”¹æ—¥ç¨‹æµç¨‹å›¾](photos/frontends/ä¿®æ”¹æ—¥ç¨‹æµç¨‹å›¾.png)
    * AIå¯¹è¯æµç¨‹å›¾ï¼š
    * ![AIå¯¹è¯æµç¨‹å›¾](photos/frontends/AIå¯¹è¯æµç¨‹å›¾.png)

## æ¡Œå® 

### 1. ç³»ç»Ÿæ¦‚è¿°

æ¡Œå® ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºPyQt5çš„æ¡Œé¢å® ç‰©åº”ç”¨ç¨‹åºï¼Œå…·æœ‰æ™ºèƒ½äº¤äº’ã€åŠ¨ç”»æ’­æ”¾ã€å¿ƒæƒ…ç®¡ç†ã€æ—¥ç¨‹ç®¡ç†ç­‰åŠŸèƒ½ã€‚ç³»ç»Ÿé‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œä½¿ç”¨å•ä¾‹æ¨¡å¼ç®¡ç†æ—¥ç¨‹æ•°æ®ï¼Œæ”¯æŒå¤šç§äº¤äº’æ–¹å¼å’ŒåŠ¨ç”»æ•ˆæœã€‚

### 2. ç”¨ä¾‹å›¾

```mermaid
graph TB
    User((ç”¨æˆ·))
    
    subgraph "æ¡Œå® ç³»ç»Ÿ"
        UC1[å¯åŠ¨æ¡Œå® ]
        UC2[ä¸æ¡Œå® äº¤äº’]
        UC3[ç®¡ç†æ—¥ç¨‹]
        UC4[èŠå¤©åŠŸèƒ½]
        UC5[é€€å‡ºç³»ç»Ÿ]
    end
    
    subgraph "äº¤äº’æ–¹å¼"
        UC2_1[å•å‡»æ˜¾ç¤ºæ¶ˆæ¯]
        UC2_2[åŒå‡»æ‹–æ‹½]
        UC2_3[å³é”®èœå•]
        UC2_4[æ‚¬åœæ˜¾ç¤ºæ°”æ³¡]
    end
    
    subgraph "èœå•åŠŸèƒ½"
        UC3_1[åˆ·æ–°æ¡Œå® çŠ¶æ€]
        UC3_2[å…³è”æ—¥ç¨‹è´¦å·]
        UC3_3[æ‰“å¼€èŠå¤©çª—å£]
        UC3_4[é€€å‡ºç¨‹åº]
    end
    
    User --> UC1
    User --> UC2
    User --> UC3
    User --> UC4
    User --> UC5
    
    UC2 --> UC2_1
    UC2 --> UC2_2
    UC2 --> UC2_3
    UC2 --> UC2_4
    
    UC2_3 --> UC3_1
    UC2_3 --> UC3_2
    UC2_3 --> UC3_3
    UC2_3 --> UC3_4
```

#### ä¸»è¦ç”¨ä¾‹è¯´æ˜

1. **å¯åŠ¨æ¡Œå® **ï¼šç”¨æˆ·å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œæ¡Œå® æ˜¾ç¤ºåœ¨æ¡Œé¢ä¸Š
2. **ä¸æ¡Œå® äº¤äº’**ï¼šç”¨æˆ·é€šè¿‡é¼ æ ‡ä¸æ¡Œå® è¿›è¡Œå„ç§äº¤äº’
3. **ç®¡ç†æ—¥ç¨‹**ï¼šç³»ç»Ÿè‡ªåŠ¨è·å–ç”¨æˆ·æ—¥ç¨‹ï¼Œæ¡Œå® æ ¹æ®æ—¥ç¨‹è°ƒæ•´å¿ƒæƒ…
4. **èŠå¤©åŠŸèƒ½**ï¼šç”¨æˆ·å¯ä»¥ä¸æ¡Œå® è¿›è¡Œæ–‡å­—èŠå¤©
5. **é€€å‡ºç³»ç»Ÿ**ï¼šç”¨æˆ·é€€å‡ºç¨‹åºï¼Œæ¡Œå® æ’­æ”¾é€€å‡ºåŠ¨ç”»

### 3. ç±»å›¾

```mermaid
classDiagram
    class PetConfig {
        +BASE_URL: str
        +SCHEDULE_REMINDER_DAYS: int
        +ANIMATION_FRAME_INTERVAL: int
        +IDLE_ACTION_INTERVAL: int
        +DEFAULT_PET_WIDTH: int
        +DEFAULT_PET_HEIGHT: int
        +get_animation_path(pet_id, animation_type, mood): str
        +get_idle_action_interval(): int
        +set_idle_action_interval(interval): void
    }
    
    class AnimationType {
        +STAND: str
        +DRAG: str
        +CHAT: str
        +STUDY: str
        +WALK: str
        +SWITCH_UP: str
        +SWITCH_DOWN: str
        +FINISH_WORK: str
        +SHUTDOWN: str
        +HUNGER: str
        +THINK: str
    }
    
    class MoodType {
        +HAPPY: str
        +NORMAL: str
        +POOR_CONDITION: str
    }
    
    class IdleActionType {
        +FINISH_WORK: str
        +THINK: str
        +HUNGER: str
        +STUDY: str
        +WALK: str
        +get_all_idle_actions(): List[str]
    }
    
    class DesktopPet {
        -id: int
        -position: Tuple[int, int]
        -mood: Mood
        -actions: List[str]
        -current_action: str
        -is_dragging: bool
        -is_chatting: bool
        -is_exiting: bool
        -is_performing_idle_action: bool
        -stats: Dict[str, Any]
        +get_id(): int
        +get_position(): Tuple[int, int]
        +get_mood_type(): str
        +perform_action(action): str
        +set_dragging_state(is_dragging): void
        +set_chatting_state(is_chatting): void
        +set_exiting_state(is_exiting): void
        +get_current_animation_path(): str
        +get_stats(): Dict[str, Any]
    }
    
    class Mood {
        -mood_type: str
        -schedule_count: int
        +getMoodType(): str
        +updateMood(schedule_count): void
        +calculateMoodType(schedule_count): str
    }
    
    class ScheduleManager {
        -schedules: List[Dict]
        -last_update_time: int
        -update_interval: int
        -count: int
        -summary: List[str]
        -_initialized: bool
        +update_schedules(): void
        +get_schedules(): List[Dict]
        +get_schedule_count(): int
        +get_active_schedules(): List[Dict]
        +get_upcoming_schedules_summary(): List[str]
        +get_upcoming_schedules_summary_count(): int
    }
    
    class DesktopPetUI {
        -controller: DesktopPetController
        -frames: List[str]
        -current_frame_index: int
        -bubble: QLabel
        -is_hovering: bool
        -is_exit_animation: bool
        +show_context_menu(position): void
        +show_bubble_message(message, mood_type): void
        +start_exit_animation(exit_callback): void
        +_handle_refresh_action(): void
        +_handle_chat_action(): void
        +_handle_account_action(): void
        +_handle_exit_action(): void
    }
    
    class DesktopPetController {
        -pet: DesktopPet
        -ui: DesktopPetUI
        -mouse_handler: MouseEventHandler
        -action_controller: PetActionController
        -idle_action_timer: QTimer
        +start_chat(): void
        +start_exit(): void
        +update_pet_mood(): void
        +_handle_idle_action(): void
        +_get_idle_action_message(action_type): str
    }
    
    class MouseEventHandler {
        -controller: DesktopPetController
        -is_dragging: bool
        -drag_start_pos: QPoint
        +mousePressEvent(event): void
        +mouseMoveEvent(event): void
        +mouseReleaseEvent(event): void
        +mouseDoubleClickEvent(event): void
    }
    
    class PetActionController {
        -pet: DesktopPet
        +perform_action(action_type): void
        +get_available_actions(): List[str]
    }
    
    class PetChatWindow {
        -pet_controller: DesktopPetController
        -chat_history: List[Dict]
        +send_message(message): void
        +receive_message(message): void
    }
    
    class LoginWindow {
        -session_id: str
        +login(username, password): bool
        +get_session_id(): str
    }
    
    PetConfig --> AnimationType
    PetConfig --> MoodType
    PetConfig --> IdleActionType
    
    DesktopPet --> Mood
    DesktopPet --> PetConfig
    
    DesktopPetUI --> DesktopPetController
    DesktopPetUI --> PetConfig
    
    DesktopPetController --> DesktopPet
    DesktopPetController --> DesktopPetUI
    DesktopPetController --> MouseEventHandler
    DesktopPetController --> PetActionController
    DesktopPetController --> ScheduleManager
    
    MouseEventHandler --> DesktopPetController
    
    PetActionController --> DesktopPet
    
    PetChatWindow --> DesktopPetController
    
    LoginWindow --> ScheduleManager
```

### 4. åºåˆ—å›¾

#### 4.1 å¯åŠ¨æ¡Œå® åºåˆ—å›¾

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant Main as main.py
    participant Controller as DesktopPetController
    participant Pet as DesktopPet
    participant UI as DesktopPetUI
    participant Config as PetConfig
    
    User->>Main: å¯åŠ¨ç¨‹åº
    Main->>Config: åŠ è½½é…ç½®
    Main->>Pet: åˆ›å»ºæ¡Œå® å®ä¾‹
    Main->>UI: åˆ›å»ºUIç•Œé¢
    Main->>Controller: åˆ›å»ºæ§åˆ¶å™¨
    Controller->>Pet: è®¾ç½®æ¡Œå® 
    Controller->>UI: è®¾ç½®UI
    Controller->>UI: æ˜¾ç¤ºæ¡Œå® 
    UI->>User: æ¡Œå® æ˜¾ç¤ºåœ¨æ¡Œé¢
```

#### 4.2 åˆ·æ–°æ¡Œå® çŠ¶æ€åºåˆ—å›¾

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant UI as DesktopPetUI
    participant ScheduleManager as ScheduleManager
    participant Backend as åç«¯API
    participant Controller as DesktopPetController
    participant Pet as DesktopPet
    
    User->>UI: å³é”®ç‚¹å‡»æ¡Œå® 
    UI->>UI: æ˜¾ç¤ºå³é”®èœå•
    User->>UI: é€‰æ‹©"åˆ·æ–°æ¡Œå® çŠ¶æ€"
    UI->>ScheduleManager: åˆ›å»ºå•ä¾‹å®ä¾‹
    ScheduleManager->>ScheduleManager: æ£€æŸ¥æ˜¯å¦å·²åˆå§‹åŒ–
    ScheduleManager->>ScheduleManager: update_schedules()
    ScheduleManager->>Backend: è·å–æ—¥ç¨‹æ•°æ®
    Backend->>ScheduleManager: è¿”å›æ—¥ç¨‹ä¿¡æ¯
    ScheduleManager->>ScheduleManager: æ›´æ–°å†…éƒ¨çŠ¶æ€
    ScheduleManager->>UI: è¿”å›æ›´æ–°ç»“æœ
    UI->>Controller: é€šçŸ¥çŠ¶æ€æ›´æ–°
    Controller->>Pet: æ›´æ–°æ¡Œå® å¿ƒæƒ…
    Pet->>UI: æ›´æ–°æ˜¾ç¤ºçŠ¶æ€
    UI->>User: æ˜¾ç¤ºæ›´æ–°å®Œæˆæ¶ˆæ¯
```

#### 4.3 é€€å‡ºæ¡Œå® åºåˆ—å›¾

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant UI as DesktopPetUI
    participant Controller as DesktopPetController
    participant Pet as DesktopPet
    participant Config as PetConfig
    
    User->>UI: å³é”®é€‰æ‹©"é€€å‡º"
    UI->>Controller: _handle_exit_action()
    Controller->>Pet: set_exiting_state(True)
    Controller->>UI: start_exit_animation()
    UI->>UI: æ’­æ”¾é€€å‡ºåŠ¨ç”»
    UI->>Config: è·å–é€€å‡ºåŠ¨ç”»è·¯å¾„
    Config->>UI: è¿”å›åŠ¨ç”»è·¯å¾„
    UI->>UI: æ’­æ”¾åŠ¨ç”»å¸§
    UI->>UI: åŠ¨ç”»æ’­æ”¾å®Œæˆ
    UI->>UI: _finish_exit_animation()
    UI->>UI: å»¶è¿Ÿ500msåé€€å‡º
    UI->>User: ç¨‹åºé€€å‡º
```

### 5. çŠ¶æ€å›¾

#### 5.1 æ¡Œå® çŠ¶æ€å›¾

```mermaid
stateDiagram-v2
    [*] --> å¾…æœºçŠ¶æ€
    
    å¾…æœºçŠ¶æ€ --> æ‹–æ‹½çŠ¶æ€ : åŒå‡»
    æ‹–æ‹½çŠ¶æ€ --> å¾…æœºçŠ¶æ€ : é‡Šæ”¾é¼ æ ‡
    
    å¾…æœºçŠ¶æ€ --> èŠå¤©çŠ¶æ€ : å³é”®èœå•é€‰æ‹©èŠå¤©
    èŠå¤©çŠ¶æ€ --> å¾…æœºçŠ¶æ€ : å…³é—­èŠå¤©çª—å£
    
    å¾…æœºçŠ¶æ€ --> å¾…æœºåŠ¨ä½œçŠ¶æ€ : å®šæ—¶è§¦å‘
    å¾…æœºåŠ¨ä½œçŠ¶æ€ --> å¾…æœºçŠ¶æ€ : åŠ¨ä½œå®Œæˆ
    
    å¾…æœºçŠ¶æ€ --> é€€å‡ºçŠ¶æ€ : å³é”®èœå•é€‰æ‹©é€€å‡º
    æ‹–æ‹½çŠ¶æ€ --> é€€å‡ºçŠ¶æ€ : å³é”®èœå•é€‰æ‹©é€€å‡º
    èŠå¤©çŠ¶æ€ --> é€€å‡ºçŠ¶æ€ : å³é”®èœå•é€‰æ‹©é€€å‡º
    å¾…æœºåŠ¨ä½œçŠ¶æ€ --> é€€å‡ºçŠ¶æ€ : å³é”®èœå•é€‰æ‹©é€€å‡º
    
    é€€å‡ºçŠ¶æ€ --> [*] : é€€å‡ºåŠ¨ç”»å®Œæˆ
```

#### 5.2 å¿ƒæƒ…çŠ¶æ€å›¾

```mermaid
stateDiagram-v2
    [*] --> Happy
    
    Happy --> Normal : æ—¥ç¨‹æ•°é‡å¢åŠ 
    Normal --> Happy : æ—¥ç¨‹æ•°é‡å‡å°‘
    Normal --> PoorCondition : æ—¥ç¨‹æ•°é‡å¤§å¹…å¢åŠ 
    PoorCondition --> Normal : æ—¥ç¨‹æ•°é‡å‡å°‘
    PoorCondition --> Happy : æ—¥ç¨‹æ•°é‡å¤§å¹…å‡å°‘
    
    Happy --> Happy : æ— æ—¥ç¨‹å˜åŒ–
    Normal --> Normal : æ— æ—¥ç¨‹å˜åŒ–
    PoorCondition --> PoorCondition : æ— æ—¥ç¨‹å˜åŒ–
```

#### 5.3 ScheduleManagerå•ä¾‹çŠ¶æ€å›¾

```mermaid
stateDiagram-v2
    [*] --> æœªåˆå§‹åŒ–
    
    æœªåˆå§‹åŒ– --> å·²åˆå§‹åŒ– : ç¬¬ä¸€æ¬¡è°ƒç”¨__init__
    å·²åˆå§‹åŒ– --> å·²åˆå§‹åŒ– : åç»­è°ƒç”¨__init__(ç›´æ¥è¿”å›)
    
    å·²åˆå§‹åŒ– --> æ›´æ–°ä¸­ : update_schedules()
    æ›´æ–°ä¸­ --> å·²åˆå§‹åŒ– : æ›´æ–°å®Œæˆ
    æ›´æ–°ä¸­ --> å·²åˆå§‹åŒ– : æ›´æ–°å¤±è´¥
    
    å·²åˆå§‹åŒ– --> [*] : ç¨‹åºé€€å‡º
```

### 6. ç³»ç»Ÿæ¶æ„ç‰¹ç‚¹

#### 6.1 è®¾è®¡æ¨¡å¼åº”ç”¨

1. **å•ä¾‹æ¨¡å¼**ï¼šScheduleManageré‡‡ç”¨å•ä¾‹æ¨¡å¼ï¼Œç¡®ä¿å…¨å±€å”¯ä¸€å®ä¾‹
2. **MVCæ¨¡å¼**ï¼šModel(DesktopPet) - View(DesktopPetUI) - Controller(DesktopPetController)
3. **è§‚å¯Ÿè€…æ¨¡å¼**ï¼šUIç»„ä»¶è§‚å¯Ÿæ¡Œå® çŠ¶æ€å˜åŒ–å¹¶æ›´æ–°æ˜¾ç¤º

#### 6.2 æ¨¡å—åŒ–è®¾è®¡

- **é…ç½®ç®¡ç†**ï¼šPetConfigç»Ÿä¸€ç®¡ç†æ‰€æœ‰é…ç½®
- **æ•°æ®æ¨¡å‹**ï¼šDesktopPetç®¡ç†æ ¸å¿ƒæ•°æ®
- **UIå±‚**ï¼šDesktopPetUIå¤„ç†ç•Œé¢æ˜¾ç¤º
- **æ§åˆ¶å±‚**ï¼šDesktopPetControlleråè°ƒå„æ¨¡å—
- **å·¥å…·ç±»**ï¼šScheduleManagerã€Moodç­‰æä¾›ç‰¹å®šåŠŸèƒ½

#### 6.3 æ‰©å±•æ€§è®¾è®¡

- æ”¯æŒæ·»åŠ æ–°çš„åŠ¨ç”»ç±»å‹
- æ”¯æŒæ·»åŠ æ–°çš„å¿ƒæƒ…çŠ¶æ€
- æ”¯æŒæ·»åŠ æ–°çš„äº¤äº’æ–¹å¼
- æ”¯æŒæ·»åŠ æ–°çš„å¾…æœºåŠ¨ä½œ

### 7. æ€»ç»“

æ¡Œå® ç³»ç»Ÿé‡‡ç”¨ç°ä»£åŒ–çš„è½¯ä»¶æ¶æ„è®¾è®¡ï¼Œå…·æœ‰è‰¯å¥½çš„æ¨¡å—åŒ–ã€å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚é€šè¿‡å•ä¾‹æ¨¡å¼ä¼˜åŒ–äº†èµ„æºç®¡ç†ï¼Œé€šè¿‡MVCæ¨¡å¼å®ç°äº†æ¸…æ™°çš„èŒè´£åˆ†ç¦»ï¼Œé€šè¿‡çŠ¶æ€å›¾ç®¡ç†ç¡®ä¿äº†ç³»ç»ŸçŠ¶æ€çš„æ­£ç¡®æ€§ã€‚ç³»ç»Ÿæ”¯æŒä¸°å¯Œçš„äº¤äº’æ–¹å¼å’ŒåŠ¨ç”»æ•ˆæœï¼Œä¸ºç”¨æˆ·æä¾›äº†è‰¯å¥½çš„ä½¿ç”¨ä½“éªŒã€‚ 

## åç«¯

```mermaid
graph TB
    %% ===== å‚ä¸è€… =====
    User(("ğŸ‘¤ ç”¨æˆ·"))
    style User fill:#f5f5f5,stroke:#333,stroke-width:2px

    %% ===== åŠŸèƒ½æ¨¡å— =====
    IntentAnalyzer{æ„å›¾åˆ†æ}
    ResponseGenerator(["å“åº”ç”Ÿæˆ"])

    subgraph "æ—¥ç¨‹ç®¡ç†"
        B1[["åˆ›å»ºæ—¥ç¨‹"]]
        B2[["ä¿®æ”¹æ—¥ç¨‹"]]
        B3[["åˆ é™¤æ—¥ç¨‹"]]
        B4[["æŸ¥è¯¢æ—¥ç¨‹"]]
    end

    Dialog["é€šç”¨å¯¹è¯"]

    %% ===== äº¤äº’é€»è¾‘ =====
    User -->|è‡ªç„¶è¯­è¨€è¾“å…¥| IntentAnalyzer
    IntentAnalyzer -->|åˆ›å»ºæŒ‡ä»¤| B1
    IntentAnalyzer -->|ä¿®æ”¹æŒ‡ä»¤| B2
    IntentAnalyzer -->|åˆ é™¤æŒ‡ä»¤| B3
    IntentAnalyzer -->|æŸ¥è¯¢æŒ‡ä»¤| B4
    IntentAnalyzer -->|é—²èŠæŒ‡ä»¤| Dialog

    B1 --> ResponseGenerator
    B2 --> ResponseGenerator
    B3 --> ResponseGenerator
    B4 --> ResponseGenerator
    Dialog --> ResponseGenerator

    ResponseGenerator -->|ç»“æ„åŒ–è¾“å‡º| User

    %% ===== æ ·å¼ä¼˜åŒ– =====
    classDef user fill:#e3f2fd,stroke:#2196f3
    classDef intent diamond,fill:#bbdefb,stroke:#0d47a1
    classDef schedule fill:#c8e6c9,stroke:#2e7d32
    classDef dialog fill:#ffecb3,stroke:#ffa000
    classDef response fill:#fce4ec,stroke:#e91e63

    class User user
    class IntentAnalyzer intent
    class B1,B2,B3,B4 schedule
    class Dialog dialog
    class ResponseGenerator response

    linkStyle 0 stroke:#666,stroke-width:2px
    linkStyle 1,2,3,4,5 stroke:#1976d2,stroke-width:1.5px
    linkStyle 6,7,8,9,10 stroke:#4caf50,stroke-width:1.5px
    linkStyle 11 stroke:#ff9800,stroke-width:2px
```

ç±»å›¾

```mermaid
classDiagram
    class Database {
        +connect()
        +disconnect()
        +read()
        +write()
    }
    
    class ScheduleManager {
        +createSchedule()
        +updateSchedule()
        +deleteSchedule()
        +querySchedule()
        +syncSchedule()
        +remindSchedule()
    }
    
    class Scheduler {
        -scheduleManager: ScheduleManager
        +init()
        +createSchedule()
        +updateSchedule()
        +deleteSchedule()
        +querySchedule()
    }
    
    class AIScheduler {
        -promptGenerator: PromptGenerator
        -aiScheduleManager: AIScheduleManager
        +analyzeIntent()
        +generateResponse()
        +processAIChat()
    }
    
    class PromptGenerator {
        +generateSemanticPrompt()
        +generateCreationPrompt()
        +generateModificationPrompt()
        +generateQueryPrompt()
    }
    
    class AIScheduleManager {
        +analyzeUserInput()
        +generateScheduleData()
        +processDialogue()
    }
    
    Database <|-- ScheduleManager
    Scheduler  --  ScheduleManager : contains
    Scheduler <|-- AIScheduler
    AIScheduler  --  PromptGenerator : contains
    AIScheduler  --  AIScheduleManager : contains
```

åˆ›å»ºæ—¥ç¨‹åºåˆ—å›¾

```mermaid
sequenceDiagram
    participant User
    participant AIScheduler
    participant PromptGenerator
    participant AIScheduleManager
    participant Scheduler
    participant ScheduleManager
    
    User->>AIScheduler: åˆ›å»ºæ—¥ç¨‹è¯·æ±‚
    AIScheduler->>PromptGenerator: ç”Ÿæˆè¯­ä¹‰åˆ†ææç¤ºè¯
    AIScheduler->>AIScheduleManager: è¯­ä¹‰åˆ†æ(åˆ›å»ºæ„å›¾)
    AIScheduler->>PromptGenerator: ç”Ÿæˆåˆ›å»ºä¸“ç”¨æç¤ºè¯
    AIScheduler->>AIScheduleManager: å¤„ç†åˆ›å»ºå“åº”
    AIScheduler->>Scheduler: create_schedule(æ—¥ç¨‹æ•°æ®)
    Scheduler->>ScheduleManager: åˆ›å»ºæ—¥ç¨‹
    ScheduleManager->>Database: å†™å…¥æ•°æ®åº“
    ScheduleManager-->>Scheduler: è¿”å›æ—¥ç¨‹ID
    Scheduler-->>AIScheduler: è¿”å›åˆ›å»ºç»“æœ
    AIScheduler-->>User: è¿”å›åˆ›å»ºæˆåŠŸ
```

ä¿®æ”¹æ—¥ç¨‹åºåˆ—å›¾

```mermaid
sequenceDiagram
    participant User
    participant AIScheduler
    participant PromptGenerator
    participant AIScheduleManager
    participant Scheduler
    participant ScheduleManager
    participant Database
    
    User->>AIScheduler: ä¿®æ”¹æ—¥ç¨‹è¯·æ±‚(æ—¥ç¨‹ID+æ–°å†…å®¹)
    AIScheduler->>PromptGenerator: ç”Ÿæˆä¿®æ”¹æ„å›¾åˆ†ææç¤ºè¯
    AIScheduler->>AIScheduleManager: åˆ†æä¿®æ”¹æ„å›¾
    AIScheduler->>PromptGenerator: ç”Ÿæˆä¿®æ”¹å†…å®¹æå–æç¤ºè¯
    AIScheduler->>AIScheduleManager: æå–ä¿®æ”¹å­—æ®µ
    AIScheduler->>Scheduler: update_schedule(æ—¥ç¨‹ID,ä¿®æ”¹å†…å®¹)
    Scheduler->>ScheduleManager: æ‰§è¡Œä¿®æ”¹
    ScheduleManager->>Database: æŸ¥è¯¢åŸæ—¥ç¨‹
    Database-->>ScheduleManager: è¿”å›åŸæ—¥ç¨‹æ•°æ®
    ScheduleManager->>Database: æ›´æ–°æ—¥ç¨‹æ•°æ®
    Database-->>ScheduleManager: è¿”å›æ›´æ–°ç»“æœ
    ScheduleManager-->>Scheduler: è¿”å›ä¿®æ”¹ç»“æœ
    Scheduler-->>AIScheduler: è¿”å›å¤„ç†ç»“æœ
    AIScheduler->>PromptGenerator: ç”Ÿæˆä¿®æ”¹æˆåŠŸå›å¤æç¤ºè¯
    AIScheduler->>AIScheduleManager: ç”Ÿæˆç”¨æˆ·å‹å¥½å›å¤
    AIScheduler-->>User: è¿”å›ä¿®æ”¹æˆåŠŸæ¶ˆæ¯
```

åˆ é™¤æ—¥ç¨‹åºåˆ—å›¾

```mermaid
sequenceDiagram
    participant User
    participant AIScheduler
    participant PromptGenerator
    participant AIScheduleManager
    participant Scheduler
    participant ScheduleManager
    participant Database
    
    User->>AIScheduler: åˆ é™¤æ—¥ç¨‹è¯·æ±‚(æ—¥ç¨‹ID)
    AIScheduler->>PromptGenerator: ç”Ÿæˆåˆ é™¤æ„å›¾åˆ†ææç¤ºè¯
    AIScheduler->>AIScheduleManager: åˆ†æåˆ é™¤æ„å›¾
    AIScheduler->>PromptGenerator: ç”Ÿæˆç¡®è®¤æç¤ºè¯
    AIScheduler->>AIScheduleManager: ç”Ÿæˆç¡®è®¤è¯æœ¯
    User->>AIScheduler: ç¡®è®¤åˆ é™¤
    AIScheduler->>Scheduler: delete_schedule(æ—¥ç¨‹ID)
    Scheduler->>ScheduleManager: æ‰§è¡Œåˆ é™¤
    ScheduleManager->>Database: æŸ¥è¯¢æ—¥ç¨‹å­˜åœ¨
    Database-->>ScheduleManager: è¿”å›æ—¥ç¨‹æ•°æ®
    ScheduleManager->>Database: æ ‡è®°æ—¥ç¨‹ä¸ºå·²åˆ é™¤
    Database-->>ScheduleManager: è¿”å›åˆ é™¤ç»“æœ
    ScheduleManager-->>Scheduler: è¿”å›åˆ é™¤ç»“æœ
    Scheduler-->>AIScheduler: è¿”å›å¤„ç†ç»“æœ
    AIScheduler->>PromptGenerator: ç”Ÿæˆåˆ é™¤æˆåŠŸå›å¤æç¤ºè¯
    AIScheduler->>AIScheduleManager: ç”Ÿæˆç”¨æˆ·å‹å¥½å›å¤
    AIScheduler-->>User: è¿”å›åˆ é™¤æˆåŠŸæ¶ˆæ¯
```

æŸ¥è¯¢æ—¥ç¨‹åºåˆ—å›¾

```mermaid
sequenceDiagram
    participant User
    participant AIScheduler
    participant PromptGenerator
    participant AIScheduleManager
    participant Scheduler
    participant ScheduleManager
    participant Database
    
    User->>AIScheduler: æŸ¥è¯¢æ—¥ç¨‹è¯·æ±‚(æŸ¥è¯¢æ¡ä»¶)
    AIScheduler->>PromptGenerator: ç”ŸæˆæŸ¥è¯¢æ„å›¾åˆ†ææç¤ºè¯
    AIScheduler->>AIScheduleManager: åˆ†ææŸ¥è¯¢æ„å›¾
    AIScheduler->>PromptGenerator: ç”ŸæˆæŸ¥è¯¢æ¡ä»¶æå–æç¤ºè¯
    AIScheduler->>AIScheduleManager: è§£ææŸ¥è¯¢æ¡ä»¶
    AIScheduler->>Scheduler: query_schedule(è§£æåæ¡ä»¶)
    Scheduler->>ScheduleManager: æ‰§è¡ŒæŸ¥è¯¢
    ScheduleManager->>Database: æ„å»ºæŸ¥è¯¢è¯­å¥
    Database-->>ScheduleManager: è¿”å›æŸ¥è¯¢ç»“æœ
    ScheduleManager-->>Scheduler: è¿”å›æ—¥ç¨‹åˆ—è¡¨
    Scheduler-->>AIScheduler: è¿”å›åŸå§‹æŸ¥è¯¢ç»“æœ
    AIScheduler->>PromptGenerator: ç”Ÿæˆç»“æœæ ¼å¼åŒ–æç¤ºè¯
    AIScheduler->>AIScheduleManager: æ ¼å¼åŒ–æŸ¥è¯¢ç»“æœ
    AIScheduler-->>User: è¿”å›æ ¼å¼åŒ–æŸ¥è¯¢ç»“æœ
```

é€šç”¨å¯¹è¯åºåˆ—å›¾

```mermaid
sequenceDiagram
    participant User
    participant AIScheduler
    participant PromptGenerator
    participant AIScheduleManager
    
    User->>AIScheduler: é€šç”¨å¯¹è¯è¯·æ±‚(å†…å®¹)
    AIScheduler->>PromptGenerator: ç”Ÿæˆå¯¹è¯æ„å›¾åˆ†ææç¤ºè¯
    AIScheduler->>AIScheduleManager: åˆ†æå¯¹è¯æ„å›¾
 
    AIScheduler->>PromptGenerator: ç”Ÿæˆé€šç”¨å›å¤æç¤ºè¯
    AIScheduler->>AIScheduleManager: ç”Ÿæˆé€šç”¨å›å¤
    
    AIScheduler-->>User: è¿”å›å¯¹è¯å›å¤
```

```mermaid
stateDiagram-v2
Â  Â  state "æ—¥ç¨‹çŠ¶æ€" as main {
Â  Â  Â  Â  æœªåˆ›å»º --> å·²åˆ›å»º: ğŸ“… åˆ›å»ºæ—¥ç¨‹
Â  Â  Â  Â  
Â  Â  Â  Â  state æ´»è·ƒçŠ¶æ€ {
Â  Â  Â  Â  Â  Â  å·²åˆ›å»º --> å·²ä¿®æ”¹: âœ ä¿®æ”¹å†…å®¹
Â  Â  Â  Â  Â  Â  å·²ä¿®æ”¹ --> å·²åˆ›å»º: ğŸ”™ æ”¾å¼ƒä¿®æ”¹
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  æ´»è·ƒçŠ¶æ€ --> å·²åˆ é™¤: ğŸ—‘ åˆ é™¤æ—¥ç¨‹
Â  Â  Â  Â  æ´»è·ƒçŠ¶æ€ --> å·²å½’æ¡£: ğŸ“¦ å½’æ¡£æ—¥ç¨‹
Â  Â  Â  Â  å·²å½’æ¡£ --> å·²åˆ é™¤: ğŸ—‘ åˆ é™¤æ—¥ç¨‹
Â  Â  }
Â  Â  å·²åˆ é™¤ --> [*]: âœ… å®Œæˆæ¸…ç†

```

